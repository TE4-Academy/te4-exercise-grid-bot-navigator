# Niv√• 6: Power-ups och Hinder

**Tid:** Ca 60 minuter (1 timme)  
**Sv√•righetsgrad:** ‚≠ê‚≠ê‚≠ê Utmanande  
**F√∂rkunskaper:** Niv√• 5 slutf√∂rd

---

## ‚è±Ô∏è Tidsplanering (viktig!)

| Steg       | Aktivitet                       | Tid    | Klar vid |
| ---------- | ------------------------------- | ------ | -------- |
| **Steg 1** | Kopiera fr√•n 5 och planera      | 5 min  | XX:05    |
| **Steg 2** | Uppdatera spawnItems()          | 10 min | XX:15    |
| **Steg 3** | Uppdatera collectItem()         | 10 min | XX:25    |
| **Steg 4** | Blockera r√∂relse (hinder-check) | 15 min | XX:40    |
| **Steg 5** | checkGameOver() f√∂r trash       | 5 min  | XX:45    |
| **Steg 6** | UI - rendera olika item-typer   | 10 min | XX:55    |
| **Test**   | Testning                        | 5 min  | XX:60    |

**üí° Tips:** Fyll i "Klar vid" med faktiska klockslag n√§r du b√∂rjar. T.ex. om du b√∂rjar 16:00, skriv 16:05, 16:15, etc.

**‚ö†Ô∏è DETTA √ÑR NYTT MATERIAL:** I lektionen t√§ckte vi inte flera item-typer. Detta √§r din f√∂rsta riktiga utmaning!

---

## üéØ M√•l

Bygg vidare p√• timer-spelet och l√§gg till olika item-typer:

- **Hinder** (üß±) som blockerar r√∂relse
- **Power-ups** (‚ö°) som ger +5 sekunder
- **Skr√§p** (üóëÔ∏è) som ger po√§ng (fr√•n tidigare)

Efter denna niv√• ska du kunna:

- Hantera olika typer av items i samma array
- Anv√§nda `switch`-satser f√∂r olika logik
- F√∂rhindra r√∂relse baserat p√• items
- Skapa mer komplexa spelmekaniker

---

## üìù Uppgift

Du ska bygga vidare p√• ditt spel fr√•n Niv√• 5 och l√§gga till variation:

1. Spelet har nu **3 typer av items**: skr√§p, hinder, power-ups
2. **Skr√§p (üóëÔ∏è)**: +10 po√§ng, f√∂rsvinner n√§r det samlas
3. **Power-ups (‚ö°)**: +5 sekunder, f√∂rsvinner n√§r det samlas
4. **Hinder (üß±)**: Blockerar r√∂relse, permanent
5. Spelaren vinner n√§r allt SKR√ÑP √§r samlat (hinder r√§knas inte)

---

## üèóÔ∏è Struktur

### Filer du ska arbeta i:

- `game.js` - L√§gg till item-typ logik
- `app.js` - Rendera olika items med olika emojis
- Samma HTML som tidigare (inget nytt UI beh√∂vs)

---

## üöÄ Kom ig√•ng

### Steg 1: Kopiera fr√•n Niv√• 5 och planera (‚è±Ô∏è 5 min)

**Vad du ska g√∂ra:**

1. Skapa en ny mapp `niva-6`
2. Kopiera ALLA filer fr√•n `niva-5` dit
3. √ñppna och testa - grundspelet ska fungera
4. F√∂rst√• m√•let: Vi ska ha 3 typer av items ist√§llet f√∂r 1

**F√∂rst√• konceptet:**

- **üóëÔ∏è Skr√§p (trash)**: +10 po√§ng, f√∂rsvinner, m√•ste samlas f√∂r vinst
- **‚ö° Power-ups (powerup)**: +5 sekunder, f√∂rsvinner, INTE n√∂dv√§ndiga f√∂r vinst
- **üß± Hinder (obstacle)**: Blockerar r√∂relse, f√∂rsvinner ALDRIG

**‚úÖ Checkpoint:** Grundspelet fr√•n 5 fungerar. Du f√∂rst√•r skillnaden mellan item-typerna.

---

### Steg 2: Uppdatera spawnItems() f√∂r olika typer (‚è±Ô∏è 10 min)

**M√•l:** √Ñndra funktionen att ta 3 parametrar och skapa olika item-typer.

**TIPS:** Anv√§nd samma logik 3 g√•nger - en f√∂r varje typ!

Uppdatera din `spawnItems()` funktion i `game.js`:

```javascript
spawnItems(trashCount, obstacleCount, powerupCount) {
  this.items = [];

  // Hj√§lpfunktion f√∂r att kolla om position √§r ledig
  const isPositionFree = (x, y) => {
    if (x === this.player.x && y === this.player.y) return false;
    return !this.items.some(item => item.x === x && item.y === y);
  };

  // Skapa skr√§p
  for (let i = 0; i < trashCount; i++) {
    let x, y;
    do {
      x = Math.floor(Math.random() * 10);
      y = Math.floor(Math.random() * 10);
    } while (!isPositionFree(x, y));

    this.items.push({ x, y, type: 'trash' });
  }

  // Skapa hinder
  for (let i = 0; i < obstacleCount; i++) {
    let x, y;
    do {
      x = Math.floor(Math.random() * 10);
      y = Math.floor(Math.random() * 10);
    } while (!isPositionFree(x, y));

    this.items.push({ x, y, type: 'obstacle' });
  }

  // Skapa power-ups
  for (let i = 0; i < powerupCount; i++) {
    let x, y;
    do {
      x = Math.floor(Math.random() * 10);
      y = Math.floor(Math.random() * 10);
    } while (!isPositionFree(x, y));

    this.items.push({ x, y, type: 'powerup' });
  }
}
```

**F√∂rst√• koden:**

- Vi anv√§nder `do...while` loop f√∂r att hitta lediga positioner
- `isPositionFree()` kollar b√•de spelarposition OCH andra items
- Vi kallar `push()` med r√§tt `type` f√∂r varje kategori

**Uppdatera startGame():**

Hitta din `startGame()` och √§ndra:

```javascript
// Gammalt:
this.spawnItems(5);

// Nytt:
this.spawnItems(5, 3, 2); // 5 skr√§p, 3 hinder, 2 power-ups
```

**Testa nu:** K√∂r `game.spawnItems(5, 3, 2)` i console, sedan `game.items`. Du ska se 10 items med olika `type`!

**‚úÖ Checkpoint:** Du har 10 items totalt med blandade typer.

---

### Steg 3: Byt namn collectTrash() ‚Üí collectItem() (‚è±Ô∏è 10 min)

**M√•l:** Hantera olika item-typer med switch-sats.

Hitta din `collectTrash()` funktion och BYT NAMN till `collectItem()`. L√§gg till switch-logik:

```javascript
collectItem(index) {
  const item = this.items[index];
  console.log('üì¶ Interagerade med:', item.type);

  switch(item.type) {
    case 'trash':
      this.score += 10;
      this.items.splice(index, 1);
      console.log('üóëÔ∏è Samlade skr√§p! +10p. Score:', this.score);
      break;

    case 'powerup':
      this.timeLeft += 5;
      this.items.splice(index, 1);
      console.log('‚ö° Power-up! +5 sekunder! Tid:', this.timeLeft);
      break;

    case 'obstacle':
      // Hinder kan inte samlas - g√∂r inget!
      console.log('üß± Det h√§r √§r ett hinder! Kan inte samlas.');
      break;
  }

  // Kolla game over (f√∂r att kolla win condition)
  this.checkGameOver();
}
```

**F√∂rst√• koden:**

- `switch(item.type)` kollar vilken typ itemet har
- Varje `case` hanterar en specifik typ
- ENDAST trash och powerup f√∂rsvinner (`splice`)
- Obstacles g√∂r INGENTING n√§r man k√∂r in i dem

**Uppdatera checkCollision():**

Hitta din `checkCollision()` och √§ndra anropet:

```javascript
// I checkCollision(), √§ndra:
// Gammalt:
this.collectTrash(i);

// Nytt:
this.collectItem(i);
```

**Testa nu:**

1. Spawna items med `game.spawnItems(2, 1, 1)`
2. Flytta spelaren till olika items manuellt i console
3. Kolla console-loggen - olika typer ska ge olika meddelanden

**‚úÖ Checkpoint:** Olika item-typer har olika effekter n√§r du k√∂r in i dem.

---

### Steg 4: Blockera r√∂relse in i hinder (‚è±Ô∏è 15 min)

**M√•l:** F√∂rhindra spelaren fr√•n att g√• igenom obstacles.

**VIKTIGT:** Vi m√•ste kolla INNAN vi flyttar, inte efter!

Uppdatera din `moveForward()` helt:

```javascript
moveForward() {
  // 1. Ber√§kna n√§sta position (utan att faktiskt flytta √§n)
  let nextX = this.player.x;
  let nextY = this.player.y;

  if (this.player.direction === 'NORTH' && this.player.y < 9) {
    nextY++;
  } else if (this.player.direction === 'EAST' && this.player.x < 9) {
    nextX++;
  } else if (this.player.direction === 'SOUTH' && this.player.y > 0) {
    nextY--;
  } else if (this.player.direction === 'WEST' && this.player.x > 0) {
    nextX--;
  } else {
    console.log('üö´ Kant av rutn√§tet!');
    return; // Utanf√∂r rutn√§tet
  }

  // 2. NYTT: Kolla om n√§sta position har ett hinder
  const isObstacle = this.items.some(item =>
    item.x === nextX && item.y === nextY && item.type === 'obstacle'
  );

  if (isObstacle) {
    console.log('‚ö†Ô∏è Hinder i v√§gen! Kan inte g√•!');
    return; // STOPPA - g√• inte
  }

  // 3. Om allt OK: NU flyttar vi faktiskt
  this.player.x = nextX;
  this.player.y = nextY;

  // 4. Kolla kollision (f√∂r trash och powerups)
  this.checkCollision();
}
```

**F√∂rst√• koden:**

- Vi r√§knar ut N√ÑSTA position INNAN vi flyttar
- Vi anv√§nder `.some()` f√∂r att kolla om det finns ett obstacle d√§r
- Om obstacle: `return` (avbryt funktionen, ingen flytt)
- Om OK: flytta till n√§sta position
- SEN kolla collision (f√∂r att plocka upp trash/powerups)

**Varf√∂r i denna ordning?**

1. Ber√§kna n√§sta position
2. Kolla om det √§r blockerat (obstacle)
3. Om OK, flytta
4. Kolla vad som finns d√§r (trash/powerup)

**Testa nu:**

1. Spawna items med obstacles: `game.spawnItems(3, 2, 1)`
2. F√∂rs√∂k navigera TILL ett obstacle
3. Du ska INTE kunna g√• dit - console ska s√§ga "Hinder i v√§gen!"

**‚úÖ Checkpoint:** Spelaren kan INTE g√• igenom obstacles.

---

### Steg 5: Uppdatera checkGameOver() f√∂r trash (‚è±Ô∏è 5 min)

**M√•l:** Endast TRASH ska r√§knas f√∂r win condition, inte obstacles eller powerups!

Hitta din `checkGameOver()` och uppdatera win-checken:

```javascript
checkGameOver() {
  // Lose: tiden slut
  if (this.timeLeft <= 0) {
    this.gameStatus = 'lost';
    clearInterval(this.gameInterval);
    alert(`‚è∞ TIDEN √ÑR UTE! Score: ${this.score}`);
    return;
  }

  // Win: allt SKR√ÑP √§r samlat (ignorera hinder och power-ups!)
  const trashLeft = this.items.filter(item => item.type === 'trash').length;

  if (trashLeft === 0) {
    this.gameStatus = 'won';
    clearInterval(this.gameInterval);
    alert(`üéâ DU VANN! Score: ${this.score} | Tid kvar: ${this.timeLeft}s`);
    return;
  }
}
```

**F√∂rst√• koden:**

- `filter(item => item.type === 'trash')` = bara trash-items
- `.length` = antal trash kvar
- Om 0 trash kvar = vinst! (√§ven om obstacles och powerups finns kvar)

**Testa nu:**

1. Spawna med lite items: `game.spawnItems(2, 1, 1)`
2. Samla de 2 trash-bitarna
3. Du ska vinna √§ven om obstacles och powerups finns kvar!

**‚úÖ Checkpoint:** Du kan vinna utan att samla powerups eller ta bort obstacles.

---

### Steg 6: UI - Rendera olika item-typer (‚è±Ô∏è 10 min)

### Steg 6: UI - Rendera olika item-typer (‚è±Ô∏è 10 min)

**M√•l:** Visa olika emojis f√∂r olika item-typer.

Uppdatera din `renderItems()` funktion i `app.js`:

```javascript
function renderItems() {
  // Ta bort gamla items
  itemElements.forEach((el) => el.remove());
  itemElements = [];

  // Skapa nya items
  game.items.forEach((item) => {
    const itemEl = document.createElement("div");
    itemEl.className = "item";

    // NYTT: Olika emojis baserat p√• typ
    if (item.type === "trash") {
      itemEl.textContent = "üóëÔ∏è";
    } else if (item.type === "obstacle") {
      itemEl.textContent = "üß±";
      itemEl.classList.add("obstacle"); // Extra klass f√∂r styling
    } else if (item.type === "powerup") {
      itemEl.textContent = "‚ö°";
      itemEl.classList.add("powerup"); // Extra klass f√∂r styling
    }

    itemEl.style.left = item.x * 10 + "%";
    itemEl.style.top = (9 - item.y) * 10 + "%";
    grid.appendChild(itemEl);
    itemElements.push(itemEl);
  });
}
```

**F√∂rst√• koden:**

- Vi kollar `item.type` med if/else
- Varje typ f√•r sitt eget emoji
- Vi l√§gger till extra klasser f√∂r CSS-styling (valfritt)

**BONUS: CSS f√∂r olika items (valfritt men snyggt!):**

L√§gg till i din `<style>` sektion i index.html:

```css
.item.obstacle {
  filter: brightness(0.7); /* M√∂rkare */
}

.item.powerup {
  animation: pulse 1s infinite; /* Pulserar */
}

@keyframes pulse {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.2);
  }
}
```

**Testa nu:**

1. Starta spelet
2. Du ska se:
   - üóëÔ∏è f√∂r trash
   - üß± f√∂r obstacles
   - ‚ö° f√∂r powerups (kanske pulserar om du la till CSS!)

**‚úÖ Checkpoint:** Alla item-typer har olika utseende!

---

## ‚úÖ TESTNING (‚è±Ô∏è 5 min)

    itemEl.style.left = item.x * 10 + "%";
    itemEl.style.top = (9 - item.y) * 10 + "%";
    grid.appendChild(itemEl);
    itemElements.push(itemEl);

});
}

````

---

## ‚úÖ TESTNING (‚è±Ô∏è 5 min)

**Nu √§r det dags att testa allt tillsammans!**

### Test 1: Olika item-typer spawnar

- Klicka "Starta Spel"
- R√§kna items: 5 skr√§p (üóëÔ∏è), 3 hinder (üß±), 2 power-ups (‚ö°)
- Alla ska ha olika positioner

### Test 2: Skr√§p samlas korrekt

- Navigera till ett üóëÔ∏è
- Det ska f√∂rsvinna
- Score ska √∂ka med 10

### Test 3: Power-up ger extra tid

- Navigera till en ‚ö°
- Den ska f√∂rsvinna
- Tid ska √∂ka med 5 sekunder
- Kolla timer-displayen!

### Test 4: Hinder blockerar

- F√∂rs√∂k g√• TILL ett üß±
- Du ska INTE kunna g√• dit
- Console ska s√§ga "Hinder i v√§gen!"

### Test 5: Vinn genom att samla trash

- Samla alla 5 üóëÔ∏è-items
- Powerups och obstacles f√•r finnas kvar
- Du ska vinna!

### Test 6: F√∂rlora om tiden tar slut

- Starta nytt spel
- V√§nta utan att samla
- Efter 30 sek: "TIDEN √ÑR UTE!"

**‚úÖ Checklista:**

- [ ] 5 skr√§p, 3 hinder, 2 power-ups spawnar
- [ ] Olika items har olika emojis (üóëÔ∏è, üß±, ‚ö°)
- [ ] Spelaren kan inte g√• igenom hinder
- [ ] Skr√§p f√∂rsvinner och ger +10p n√§r det samlas
- [ ] Power-ups f√∂rsvinner och ger +5s n√§r de samlas
- [ ] Hinder f√∂rblir kvar hela spelet
- [ ] Spelaren vinner n√§r allt SKR√ÑP √§r samlat (obstacles kvar = OK)
- [ ] Timern √∂kar n√§r power-up samlas

**üéâ Grattis! Om alla checkboxar √§r bockade √§r du klar med Niv√• 6!**

**DU HAR NU ETT KOMPLETT SPEL! üéÆ**

---

## üí° Tips och Tricks

### Visa counter f√∂r varje typ (BONUS)

L√§gg till i HTML:

```html
<div>Skr√§p kvar: <span id="trash-left">5</span></div>
<div>Hinder: <span id="obstacles">3</span></div>
<div>Power-ups: <span id="powerups">2</span></div>
````

Uppdatera i `updateUI()`:

```javascript
const trash = game.items.filter((i) => i.type === "trash").length;
const obstacles = game.items.filter((i) => i.type === "obstacle").length;
const powerups = game.items.filter((i) => i.type === "powerup").length;

document.getElementById("trash-left").textContent = trash;
document.getElementById("obstacles").textContent = obstacles;
document.getElementById("powerups").textContent = powerups;
```

### Debug item-typer

Logga n√§r olika saker h√§nder:

```javascript
collectItem(index) {
  const item = this.items[index];
  console.log(`üì¶ Samlade item typ: ${item.type} p√• (${item.x}, ${item.y})`);
  // ...
}
```

---

## ü§î Vanliga problem och l√∂sningar

### Problem: "Spelaren kan g√• igenom hinder"

**L√∂sning:** Kolla att du anv√§nder `.some()` F√ñRE du flyttar spelaren, inte efter. Ordningen i `moveForward()` √§r viktigt:

1. Ber√§kna nextX, nextY
2. Kolla obstacle
3. Om OK, flytta
4. Kolla collision

### Problem: "Win condition triggas f√∂r tidigt"

**L√∂sning:** Se till att endast r√§kna `type === 'trash'` i win-checken:

```javascript
const trashLeft = this.items.filter((item) => item.type === "trash").length;
```

### Problem: "Items spawnar p√• samma plats"

**L√∂sning:** Anv√§nd `do...while` loop och `isPositionFree()` funktionen i `spawnItems()`. Se Steg 2.

### Problem: "checkCollision() hittar inte items"

**L√∂sning:** Uppdatera anropet till `collectItem()` ist√§llet f√∂r `collectTrash()` i `checkCollision()`.

### Problem: "Obstacles f√∂rsvinner n√§r jag k√∂r in i dem"

**L√∂sning:** I `collectItem()`, se till att `case 'obstacle':` INTE har `splice()`. Endast break.

---

## üìä Specifikation

| Feature            | V√§rde                      |
| ------------------ | -------------------------- |
| Spelplan           | 10x10 rutn√§t               |
| Skr√§pbitar         | 5 (m√•ste samlas f√∂r vinst) |
| Hinder             | 3 (blockerar r√∂relse)      |
| Power-ups          | 2 (+5 sekunder vardera)    |
| Tid                | 30 sekunder (start)        |
| Po√§ng per skr√§pbit | 10                         |
| Max score          | 50                         |

---

## üéì N√§r du √§r klar

Testa spelet grundligt och se till att:

1. Alla tre item-typerna fungerar korrekt
2. Hinder blockerar r√∂relse
3. Power-ups ger extra tid
4. Win/lose conditions fungerar
5. UI visar olika emojis f√∂r olika typer

**Grattis!** Du har nu skapat ett komplett spel med collision detection, game loop, timer OCH olika spelmekaniker! üéâ

**N√ÑSTA STEG:** Du kan nu forts√§tta med mer avancerade features som levels, highscore, localStorage, etc!

---

## üí™ Aha-moment

Efter denna niv√• har du l√§rt dig:

- ‚úÖ **Polymorfism** - samma collision system hanterar olika item-typer
- ‚úÖ **Switch-satser** - hantera olika logik f√∂r olika typer
- ‚úÖ **Proaktiv koll** - f√∂rhindra r√∂relse INNAN den sker (hinder-check)
- ‚úÖ **Array-filtrering** - r√§kna specifika typer med `filter()`
- ‚úÖ **Komplett spelmekanik** - nu √§r det ett riktigt, varierat spel!
- ‚úÖ **Do-while loops** - perfekt f√∂r slumpm√§ssig placering
- ‚úÖ **Conditional logic** - olika beteenden baserat p√• data

---

## üèÜ Extra utmaningar (om du har tid √∂ver!)

Vill du forts√§tta utveckla spelet? Prova dessa:

### L√§tt (30 min):

- **Ljudeffekter:** L√§gg till ljud n√§r items samlas (Web Audio API)
- **Score multiplikator:** Dubblera po√§ng om du samlar 3 items i rad snabbt
- **Visuella effekter:** L√§gg till CSS animations n√§r items f√∂rsvinner

### Medel (1 tim):

- **Olika obstacle-typer:** V√§ggar vs. stenar (olika utseende)
- **Speedup power-up:** En power-up som l√•ter dig r√∂ra dig snabbare
- **Enemy robots:** Obstacles som r√∂r sig!

**Ha kul och forts√§tt koda!** üöÄ
